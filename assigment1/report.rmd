---
title: "Assignment 1"
output:
  pdf_document: default
  fig_caption: yes
  html_document:
    df_print: paged
date: "2025-02-21"
---

#### Group members: Keerthi (s243933), Katarina (s243906), Hubert (s243896), German (s243660)


## 1 Plot data

### 1.1.

```{r, fig.align='center', out.width='70%', fig.cap='The plot of observations.', echo=FALSE}
knitr::include_graphics("plots/dtrain_plot.png")
```
### 1.2.
There seems to be a general positive trend of number of vehicles in Denmark over the years. However, there is also a seasonal pattern within each year where it increases for approximately the first half of a year and then decreases. We also noticed that there is a jump at the start of 2021, and also after that the trend seems to have gotten flatter but the seasonal pattern still exists.

### 2 Linear trend model

#### 2.1
[todo] [for each member]
$$
y = \begin{bmatrix}
2.930 \\
2.934 \\
2.941
\end{bmatrix},
\quad
X = \begin{bmatrix}
1 & 2018.000 \\
1 & 2018.083 \\
1 & 2018.167
\end{bmatrix}
$$

### 2.2

\begin{table}[h]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{Parameter} & \textbf{Estimate} ($\hat{\theta}$) & \textbf{Standard Error} ($\hat{\sigma}_{\hat{\theta}}$) \\
\hline
$\hat{\theta}_1$ & -110.36 & 3.59 \\
\hline
$\hat{\theta}_2$ & 0.056 & 0.0018 \\
\hline
\end{tabular}
\caption{Parameter Estimates and Standard Errors}
\label{tab:parameters}
\end{table}

```{r, fig.align='center', out.width='70%', fig.cap='Observations and OLS Estimated Mean', echo=FALSE}
knitr::include_graphics("plots/estimated_mean.png")
```

### 2.3
The forecast results are presented in Table \ref{tab:forecast-results}.

\begin{table}[htbp]
\centering
\caption{Forecast Results}
\label{tab:forecast-results}
\begin{tabular}{cccc}
\hline
& fit & lwr & upr \\
\hline
73 & 3.281154 & 3.227579 & 3.334728 \\
74 & 3.285832 & 3.232198 & 3.339467 \\
75 & 3.290511 & 3.236815 & 3.344208 \\
76 & 3.295190 & 3.241430 & 3.348950 \\
77 & 3.299869 & 3.246044 & 3.353693 \\
78 & 3.304547 & 3.250656 & 3.358439 \\
79 & 3.309226 & 3.255267 & 3.363185 \\
80 & 3.313905 & 3.259876 & 3.367934 \\
81 & 3.318583 & 3.264483 & 3.372683 \\
82 & 3.323262 & 3.269090 & 3.377435 \\
83 & 3.327941 & 3.273694 & 3.382188 \\
84 & 3.332620 & 3.278297 & 3.386942 \\
\hline
\end{tabular}
\end{table}

### 2.4
The plot is represented in Figure \ref{fig:fig-total-plot}.
```{r, fig.align='center', out.width='70%', fig.cap='\\label{fig:fig-total-plot}Fitted model together with the training data and the forecasted values.', echo=FALSE}
knitr::include_graphics("plots/total_plot.jpeg")
```
### 2.5 
The forecast appears to be limited as it overshoots the actual values with a slope that doesn't align with the patterns, especially during the test period. The inaccuracy is further demonstrated by most forecasted values falling outside the prediction interval. All in all, this is a basic forecast, following the general trend of the data, but not seasonal shifts.

### 2.6
The residuals show confusing patterns, staying close to the reference line only in the middle while significantly deviating at both the beginning and end of the plot. The model assumptions seem to be violated as the errors aren't properly distributed around zero, with negative residuals indicating the forecast systematically overshoots actual values. This systematic error pattern suggests fundamental issues with the model specification rather than random noise, confirming the model assumptions are not fulfilled.

## 3 WLS - local linear trend model
### 3.1
The variance-covariance matrix for the local model consists of the inverse of observation weights in the diagonal and zeros otherwise. $N$ is equal to the number of observation, which is equal to $72$.
$$
\Sigma_{WLS} = 
\begin{pmatrix}
\frac{1}{\lambda^{N-1}} & 0 & \cdots & 0 \\
0 & \frac{1}{\lambda^{N-2}} & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \frac{1}{\lambda^{0}}
\end{pmatrix}
$$
Conversely, the variance-covariance matrix for the global model contains $1$ in the diagonal and zeros otherwise.
$$
\Sigma_{OLS}= 
\begin{pmatrix}
1 & 0 & \cdots & 0 \\
0 & 1 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & 1
\end{pmatrix}
$$

### 3.2
The highest weight is for the latest time point and it is equal to $\lambda^0 = 1$. The further in the past an observation point is, the more does its weight decrease. The weight distribution is visualized in Figure \ref{fig:weights}.

```{r, fig.align='center', out.width='70%', fig.cap='\\label{fig:weights}The weights of each observation in the train dataset.', echo=FALSE}
knitr::include_graphics("plots/weights_wls.jpeg")
```


### 3.3
The sum of weights for the local model is $\sum_{n=1}^{N} \lambda^{n-1} = 9.994925$. The sum of weights for the global model is equal to the number of observations, $72$.


### 3.4
According to the local model with $\lambda = 0.9$, the parameters are equal to $\theta_1=-52.4828617$ and $\theta_2=0.0275299$.

### 3.5 
The WLS model prioritizes recent data points, creating a more gradual slope that adapts to current trends. 
While OLS treats all data equally and provides a generalized fit, WLS gives higher weight to recent observations. 
We would choose WLS when new predictions are crucial, and OLS when analyzing from a long-term perspective.

```{r, fig.align='center', out.width='70%', fig.cap='The observations as well as the predictions for the OLS \\& WLS models, including prediction intervals.', echo=FALSE}
knitr::include_graphics("plots/ols_wls_prediction.jpeg")
```

## 4 Recursive estimation and optimization of $\lambda$

### 4.1
[todo]

### 4.2
[todo]

### 4.3
[todo]

### 4.4
[todo]

### 4.5
[todo]

### 4.6
[todo]

### 4.7
[todo]
